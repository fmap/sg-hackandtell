#!/bin/bash
# Designed to send off your blogs that no one can be bothered to setup a RSS feeder with

body=/tmp/sendme2 # generated by rss2email
subject="Handbrake"
domain="sg.hackandtell.org"
list=list/subs/list

test -f $body || exit

# Replace hendry with . when you want to send it out
grep hendry $list |
while read id epoch IP email
do
	{ markdown $body
	echo "<hr>"
	echo "<footer>"
	cat reminder.html
	echo "<p>Unsubscribe: <a href=http://$domain/unsubscribe/$id/$subject>http://$domain/unsubscribe/$id/$subject</a></p>"
	echo "</footer>"
	} |
	mutt -e "set content_type=text/html" -e "my_hdr List-Unsubscribe: <http://$domain/1-click-unsubscribe/$id/$subject>" -s "$subject" $email
	if test "$?" -eq 0
	then
		echo OK $email
	else
		echo ERROR $email http://$domain/1-click-unsubscribe/$id/failed-to-send
	fi
done
